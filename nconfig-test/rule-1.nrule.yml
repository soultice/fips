- Rule:
    name: "Mock 1"
    when:
      matchesUris:
        - uri: ^/mock$
    then:
      functionAs: "Mock"
      body: 
        foo: bar
        # foo: "{{TestPlugin}}"
      status: "200" 
      headers:
        Content-Type: "application/json"
        X-Test: "test"

    with:
      plugins: &plugins
        - name: "{{TestPlugin}}"
          path: './plugins/libtest_plugin.so'

- Rule:
    name: "Proxy"
    when:
      matchesUris:
        - uri: ^/proxy$
    then:
      functionAs: "Proxy"
      forwardUri: "http://localhost:8888/mock"

- Rule:
    name: "FIPS 1"
    when:
      matchesUris:
        - uri: ^/fips$
    then:
      functionAs: "Fips"
      forwardUri: "http://localhost:8888/mock"
      modifyResponse: 
        setHeaders:
          x-test: "test-fips" 
        body:
          - at: "foobar"
            with: 
              - "new"
              - "array"
          - at: "foobar.1"
            with: "replaced-value"
          - at: "foobar.>>"
            with: "appended-value"
          - at: "plugin-result"
            with: "{{RandomProductCode}}"

    with:
      # sleep: 10000
      plugins:
        - name: "{{RandomProductCode}}"
          path: './plugins/librandom_product_code.so'
          args:
            - "de"
            - "DE"
            - 1771
   


  
  
